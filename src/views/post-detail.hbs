{{!-- src/views/post-detail.hbs --}}

<div class="post-detail-container">
    <div class="post-header">
        <h1>{{post.title}}</h1>
        <div class="post-meta">
            <span class="author">By {{post.author.name}}</span>
            <span class="date">{{formatDate post.createdAt}}</span>
            {{#if post.isEdited}}
                <span class="edited">(edited)</span>
            {{/if}}
        </div>
    </div>

    <div class="post-content">
        <p>{{post.content}}</p>
    </div>

    <div class="post-footer">
        <div class="post-stats">
            <span class="likes-count">
                <i class="fas fa-heart"></i> {{post.likes.length}} likes
            </span>
            {{#if post.tags.length}}
                <div class="tags">
                    {{#each post.tags}}
                        <span class="tag">{{this}}</span>
                    {{/each}}
                </div>
            {{/if}}
        </div>
        
        {{#if currentUser}}
            <button class="like-btn" data-post-id="{{post._id}}">
                <i class="fas fa-heart"></i>
                <span class="like-text">Like</span>
            </button>
            
            {{#if currentUser}}
                {{#if (eq post.author._id currentUser.id)}}
                    <div class="post-actions">
                        <a href="/posts/{{post._id}}/edit" class="btn-secondary">Edit</a>
                        <button class="btn-danger delete-post-btn" data-post-id="{{post._id}}">Delete</button>
                    </div>
                {{/if}}
            {{/if}}
        {{/if}}
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
        <h3>Comments</h3>
        
        {{#if currentUser}}
            <form action="/api/comments" method="POST" class="comment-form">
                <input type="hidden" name="postId" value="{{post._id}}">
                <div class="form-group">
                    <textarea name="content" placeholder="Write a comment..." required rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">Post Comment</button>
            </form>
        {{else}}
            <p><a href="/">Login</a> to leave a comment.</p>
        {{/if}}

        <div class="comments-list">
            {{#if comments.length}}
                {{#each comments}}
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author">{{#if this.author}}{{this.author.name}}{{else}}Unknown{{/if}}</span>
                            <span class="comment-date">{{#if this.createdAt}}{{formatDate this.createdAt}}{{else}}Just now{{/if}}</span>
                            {{#if this.isEdited}}
                                <span class="edited">(edited)</span>
                            {{/if}}
                        </div>
                        <div class="comment-content">
                            <p>{{this.content}}</p>
                        </div>
                        <div class="comment-footer">
                            {{#if ../currentUser}}
                                {{#if (eq this.author._id ../currentUser.id)}}
                                    <button class="delete-comment-btn" data-comment-id="{{this._id}}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                {{/if}}
                            {{/if}}
                        </div>
                        
                        {{#if this.replies.length}}
                            <div class="replies">
                                {{#each this.replies}}
                                    <div class="reply">
                                        <div class="comment-header">
                                            <span class="comment-author">{{this.author.name}}</span>
                                            <span class="comment-date">{{#if this.createdAt}}{{formatDate this.createdAt}}{{else}}Just now{{/if}}</span>
                                        </div>
                                        <div class="comment-content">
                                            <p>{{this.content}}</p>
                                        </div>
                                        <div class="comment-footer">
                                            {{#if ../../currentUser}}
                                                {{#if (eq this.author._id ../../currentUser.id)}}
                                                    <button class="delete-comment-btn" data-comment-id="{{this._id}}">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                {{/if}}
                                            {{/if}}
                                        </div>
                                    </div>
                                {{/each}}
                            </div>
                        {{/if}}
                    </div>
                {{/each}}
            {{else}}
                <p>No comments yet. Be the first to comment!</p>
            {{/if}}
        </div>
    </div>
</div>
